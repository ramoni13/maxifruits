<!DOCTYPE html>
<html>
<head>
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
<script src="https://ramoni13.github.io/DJ_Festival/html5-qrcode.min.js"></script>

	<style>
        	body, button {
			font-size: 72px;
		}
	</style>
</head>
<script>
	$(document).ready(function() {
	  // Deezer playlist
	  $('#deezer-bar').click(function(){
	    $('#deezer-player').fadeIn();
	    $('#deezer-bar').hide();
	  });
	  $('#deezer-player').click(function(){
	    $('#deezer-bar').fadeIn();
	    $('#deezer-player').hide();
	  });
	});
	var modePlaylist = false;
	var playlist = [];
	function begin() {
		var html5QrcodeScanner = new Html5QrcodeScanner("reader", { fps: 10, qrbox: 400 }); 
		html5QrcodeScanner.render(onScanSuccess);
	}
	
	function onScanSuccess(qrCodeMessage) { 
		console.log(qrCodeMessage);
		if (modePlaylist) {
			var dejaTrouve = false;
			for (j = 0; j < playlist.length; j++) {
                if (playlist[j] == qrCodeMessage) {
                    dejaTrouve = true;
                }
            }
			if (!dejaTrouve) {
				playlist.push(qrCodeMessage);
				document.getElementById("nbMorceaux").innerHTML = "Nb Tracks=" + playlist.length;
			}
		} else {
			document.getElementById("reader").style.display = 'none';
			document.getElementById("playerDeezer").style.display = 'block';
			readTrack(qrCodeMessage);
		}
	};
	function validerPlaylist() {
		for (j = 0; j < playlist.length; j++) {
               console.log(playlist[j]);
            }
			// user id = 7048859
			/*
			user/{user_id}/playlists	Create a playlist	
			playlist/{playlist_id}/tracks Add a track to the playlist
			
			let url = "https://cors-anywhere.herokuapp.com/https://api.deezer.com/search?q=track:'" + track + "'";
			if (artiste != "") {
				url= url + " artist:'" + artiste + "'";
			}
			fetch(url)
			.then(response => response.json())
			.then(data => {
				let retourDeezer = data.data[0];
				genre = document.getElementById("genreSelect").value;
				titre = retourDeezer.title_short;
				idTrack = retourDeezer.id;
				rank = retourDeezer.rank;
			*/
	}
	function init() {
		document.getElementById("reader").style.display = 'none';
		document.getElementById("playerDeezer").style.display = 'none';
		document.getElementById("menu").style.display = 'block';
		document.getElementById("playlistDiv").style.display = 'none';
	}
	function oneSong() {
		modePlaylist = false;
		document.getElementById("reader").style.display = 'block';
		document.getElementById("playerDeezer").style.display = 'none';
		document.getElementById("menu").style.display = 'none';
		begin();
	}
	function createPlaylist() {
		modePlaylist = true;
		playlist = [];
		document.getElementById("reader").style.display = 'block';
		document.getElementById("playlistDiv").style.display = 'block';
		document.getElementById("playerDeezer").style.display = 'none';
		document.getElementById("menu").style.display = 'none';
		begin();
	}
	function readTrack(idTrack) {
		(function() {
		var w = document[typeof document.getElementsByClassName === 'function' ? 'getElementsByClassName' : 'querySelectorAll']('deezer-widget-player');
		for (var i = 0, l = w.length; i < l; i++) {
			w[i].innerHTML = '';
			var el = document.createElement('iframe');
			el.src = w[i].getAttribute('data-src') + "&id=" + idTrack;
			el.scrolling = w[i].getAttribute('data-scrolling');
			el.frameBorder = w[i].getAttribute('data-frameborder');
			el.setAttribute('frameBorder', w[i].getAttribute('data-frameborder'));
			el.allowTransparency = w[i].getAttribute('data-allowTransparency');
			el.width = w[i].getAttribute('data-width');
			el.height = w[i].getAttribute('data-height');
			w[i].appendChild(el);
		}
		}());
	
	}
</script>

<body width="640px" onload="javascript:init()">
	<h2>DJ's Party Mix Festival</h2>
	
	<div width="640px" id="playlistDiv">
		<div id="nbMorceaux">Nb Tracks=0</div>
		<button onclick="javascript:validerPlaylist()">Créer Playlist</button>
		<button onclick="javascript:init()">Menu</button>
	</div>
	
	<div width="640px" id="menu">
		<button onclick="javascript:oneSong()">Ecouter 1 chanson</button>
		<button onclick="javascript:createPlaylist()">Créer 1 playlist</button>
	</div>
	
	<div width="640px" id="reader"></div>
	
	<div width="640px" id="playerDeezer">
		<div class="deezer-widget-player" 
		data-src="https://www.deezer.com/plugins/player?format=classic&autoplay=false&playlist=true&width=700&height=350&color=EF5466&layout=&size=medium&type=tracks&app_id=455462" 
		data-scrolling="no" 
		data-frameborder="0" 
		data-allowTransparency="true" 
		data-width="700" 
		data-height="350">
		</div>
		<button onclick="javascript:init()">Menu</button>
	</div>
	<div id="deezer-bar">
	  <div id="bars">
	    <div class="bar"></div>
	    <div class="bar"></div>
	    <div class="bar"></div>
	    <div class="bar"></div>
	    <div class="bar"></div>
	    <div class="bar"></div>
	    <div class="bar"></div>
	    <i class="fa fa-angle-double-right link-deezer"></i>
	  </div>
	</div>
	<div id="deezer-player">
	  <iframe scrolling="no" frameborder="0" allowTransparency="true" src="http://www.deezer.com/plugins/player?autoplay=true&playlist=true&width=500&height=240&scover=true&type=playlist&id=173303071&title=&app_id=undefined" width="500" height="240" style="border-right: 2px solid #5D5D5D;"></iframe><i class="fa fa-angle-double-left link-player"></i>
	</div>
</body>
</html> 
