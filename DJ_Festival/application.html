<!DOCTYPE html>
<html>
<head>
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
<script src="https://ramoni13.github.io/DJ_Festival/html5-qrcode.min.js"></script>

	<style>
        	body, button {
			font-size: 72px;
		}
		
	</style>
</head>
<script>
	
	var modePlaylist = false;
	var playlist = [];
	var idTrackScan = 0;
	function begin() {
		var html5QrcodeScanner = new Html5QrcodeScanner("reader", { fps: 10, qrbox: 400 }); 
		html5QrcodeScanner.render(onScanSuccess);
	}
	
	function onScanSuccess(qrCodeMessage) { 
		console.log(qrCodeMessage);
		if (modePlaylist) {
			var dejaTrouve = false;
			for (j = 0; j < playlist.length; j++) {
                if (playlist[j] == qrCodeMessage) {
                    dejaTrouve = true;
                }
            }
			if (!dejaTrouve) {
				playlist.push(qrCodeMessage);
				document.getElementById("nbMorceaux").innerHTML = "Nb Tracks=" + playlist.length;
			}
		} else {
			document.getElementById("idTrackDiv").style.display = 'block';
			document.getElementById("idTrack").innerHTML = qrCodeMessage;
			idTrackScan = qrCodeMessage;
		}
	};
	function validerPlaylist() {
		for (j = 0; j < playlist.length; j++) {
               console.log(playlist[j]);
            }
			// user id = 7048859
			/*
			user/{user_id}/playlists	Create a playlist	
			playlist/{playlist_id}/tracks Add a track to the playlist
			
			let url = "https://cors-anywhere.herokuapp.com/https://api.deezer.com/search?q=track:'" + track + "'";
			if (artiste != "") {
				url= url + " artist:'" + artiste + "'";
			}
			fetch(url)
			.then(response => response.json())
			.then(data => {
				let retourDeezer = data.data[0];
				genre = document.getElementById("genreSelect").value;
				titre = retourDeezer.title_short;
				idTrack = retourDeezer.id;
				rank = retourDeezer.rank;
			*/
	}
	function init() {
		document.getElementById("reader").style.display = 'none';
		document.getElementById("playerDeezer").style.display = 'none';
		document.getElementById("menu").style.display = 'block';
		document.getElementById("playlistDiv").style.display = 'none';
		document.getElementById("idTrackDiv").style.display = 'none';
		document.getElementById("playerDeezer").style.display = 'none';
	}
	function oneSong() {
		modePlaylist = false;
		document.getElementById("reader").style.display = 'block';
		document.getElementById("playerDeezer").style.display = 'none';
		document.getElementById("menu").style.display = 'none';
		begin();
	}
	function createPlaylist() {
		modePlaylist = true;
		playlist = [];
		document.getElementById("reader").style.display = 'block';
		document.getElementById("playlistDiv").style.display = 'block';
		document.getElementById("playerDeezer").style.display = 'none';
		document.getElementById("menu").style.display = 'none';
		begin();
	}
	function readTrack() {
		document.getElementById("reader").style.display = 'none';
		document.getElementById("idTrackDiv").style.display = 'none';
		document.getElementById("playerDeezer").style.display = 'block';
		var divdeez2 = document.getElementById("deezer-player");
		var srcdeez2 = divdeez2.getAttribute("src");
		srcdeez2= srcdeez2 + "&id=" + idTrackScan;
		divdeez2.setAttribute("src", srcdeez2);
		//document.getElementById("deezer-player").src = document.getElementById("deezer-widget-player").src  + "&id=" + idTrack;
	}
</script>

<body width="800px" onload="javascript:init()">
	<h2>DJ's Party Mix Festival</h2>
		<div width="800px" id="idTrackDiv">
			<div id="idTrack"></div>
			<div id="goListen">Arrêtez le scan puis clickez sur 
				<button onclick="javascript:readTrack()">Ecouter</button>
			</div>
		</div>
	<div width="800px" id="playlistDiv">
		<div id="nbMorceaux">Nb Tracks=0</div>
		<button onclick="javascript:validerPlaylist()">Créer Playlist</button>
		<button onclick="javascript:init()">Menu</button>
	</div>
	
	<div width="800px" id="menu">
		<button onclick="javascript:oneSong()">Ecouter 1 chanson</button>
		<button onclick="javascript:createPlaylist()">Créer 1 playlist</button>
	</div>
	
	<div width="800px" id="reader"></div>
	
	<div width="800px" id="playerDeezer">
		<div >
		  <iframe id="deezer-player" scrolling="no" frameborder="0" src="https://www.deezer.com/plugins/player?format=classic&autoplay=false&playlist=true&width=700&height=350&color=EF5466&layout=&size=medium&type=tracks&app_id=455462" width="500" height="240" style="border-right: 2px solid #5D5D5D;"></iframe>
		</div>
		<button onclick="javascript:init()">Menu</button>
	</div>
	
</body>
</html> 
